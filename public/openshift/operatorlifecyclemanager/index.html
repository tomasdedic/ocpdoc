<!DOCTYPE html>
<html class="no-js" lang="en-us">
<head><script src="/livereload.js?port=1112&mindelay=10&v=2" data-no-instant defer></script>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Operator Life Cycle Manager - DIVIDED DOCUMENTATION</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="operator life cycle overview Openshift4">
	<meta name="generator" content="Hugo 0.75.0-DEV" />
	<meta property="og:title" content="Operator Life Cycle Manager" />
<meta property="og:description" content="operator life cycle overview Openshift4" />
<meta property="og:type" content="article" />
<meta property="og:url" content="//localhost:1112/openshift/operatorlifecyclemanager/" />
<meta property="article:published_time" content="2020-07-08T00:00:00+00:00" />
<meta property="article:modified_time" content="2020-07-08T00:00:00+00:00" />

	
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">
	<link rel="stylesheet" href="/css/style.css">
	<link rel="stylesheet" href="/css/custom.css">
	<link rel="shortcut icon" href="/favicon.ico">
</head>
<body class="body">
	<div class="container container--outer">
    
		<header class="header">
    
        <script src="https://cdn.jsdelivr.net/npm/lunr@2.3.8/lunr.min.js" defer></script><script src="/js/meme.min.js"></script>

    
	<div class="container">
		<div class="wrapper flex">
			<a class="logo__link" href="/" title="DIVIDED DOCUMENTATION" rel="home">
				<div class="logo__title">DIVIDED DOCUMENTATION</div>
				<div class="logo__tagline">Tech howto, pancakes and syrup</div> 
			</a>
    <aside class="search--right">
    <form id="search" class="search" role="search">
    <label for="search-input">
    </label>
    <input type="search" id="search-input" class="search-input" placeholder="search..." />
</form>




<template id="search-result" hidden>
    <article class="list__item post">
      <h3 class="list__title post__title">: <a class="summary-title-link"></a></h3>
        <summary class="summary"></summary>
            <a class="read-more-link"></a>
    </article>
</template>

    </aside>
    </div>
		
	</div>
		
<nav class="menu">
	<button class="menu__btn" aria-haspopup="true" aria-expanded="false" tabindex="0">
		<span class="menu__btn-title" tabindex="-1">Menu</span>
	</button>
  <ul class="menu__list">
    <li class="menu__item">
      <a class="menu__link" href="/categories/aks/" title="Aks">Aks</a>
    <li class="menu__item">
      <a class="menu__link" href="/categories/azure/" title="Azure">Azure</a>
    <li class="menu__item">
      <a class="menu__link" href="/categories/linux/" title="Linux">Linux</a>
    <li class="menu__item">
      <a class="menu__link" href="/categories/logging/" title="Logging">Logging</a>
    <li class="menu__item">
      <a class="menu__link" href="/categories/openshift/" title="Openshift">Openshift</a>
    <li class="menu__item">
      <a class="menu__link" href="/categories/wotw/" title="Wotw">Wotw</a>
    </li>
  </ul>
</nav>

</header>

    
		<div class="wrapper flex">
			<div class="primary">
			

 

<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Operator Life Cycle Manager</h1>
			<p class="post__lead">operator life cycle manager overview</p>
			<div class="post__meta meta">
<div class="meta__item-datetime meta__item">
	<svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg>
	<time class="meta__text" datetime="2020-07-08T00:00:00">2020-07-08</time>
</div>

<div class="meta__item-categories meta__item">
	<svg class="meta__icon icon icon-category" width="16" height="16" viewBox="0 0 16 16"><path d="m7 2l1 2h8v11h-16v-13z"/></svg>
	<span class="meta__text"><a class="meta__link" href="/categories/openshift/" rel="category">OPENSHIFT</a></span>
</div>

<div class="meta__item-categories meta__item">
	<svg class="meta__icon icon icon-category" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5 0 11V3C0 1.5.8.8.8.8S1.5 0 3 0h8c1.5 0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/></svg>
	<span class="meta__text"><a class="meta__link" href="/tags/ocp/" rel="category">OCP</a>, <a class="meta__link" href="/tags/operator/" rel="category">OPERATOR</a></span>
</div>
</div>
		</header>
		
    
		<div class="content post__content clearfix">
<p>How can I use the Operators in my Openshift4 cluster? And how are updated and managed by the Operator Lifecycle Manager? What is the components of their architecture?</p>
<p>Let’s dig in!</p>
<h1 id="1-overview">1. Overview</h1>
<p>In Openshift 4 the Operators are key for main operations, deployments and upgrades within our cluster.</p>
<p>The Operator Lifecycle Manager (OLM in short name), helps users install, update, and manage the lifecycle of all Operators and their associated services running across their clusters.</p>
<p>This OLM is part of the Operator Framework, defined by CoreOS and widely spread into the Kubernetes Community among these years.</p>
<p>The Operator Framework is an open source toolkit designed to manage Kubernetes native apps (also called Operators) in a automated, time-effective and scalable way.</p>
<h1 id="2-operator-lifecycle-manager-architecture">2. Operator Lifecycle Manager Architecture</h1>
<p>The Operator Lifecycle Manager is composed of two Operators: the OLM Operator and the Catalog Operator.</p>
<p>ClusterServiceVersion (OLM): Application metadata: name, version, icon, required resources, installation, etc.
InstallPlan (Catalog): Calculated list of resources to be created in order to automatically install or upgrade a CSV.
CatalogSource (Catalog): A repository of CSVs, CRDs, and packages that define an application.
Subscription (Catalog): Used to keep CSVs up to date by tracking a channel in a package.
OperatorGroup (OLM): Used to group multiple namespaces and prepare them for use by an Operator.</p>
<h2 id="21-olm-operator">2.1 OLM Operator</h2>
<p>The OLM Operator is responsible for deploying applications defined by CSV resources after the required resources specified in the CSV are present in the cluster.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ oc get pod -n openshift-operator-lifecycle-manager | grep olm-operator
olm-operator-7c89775499-hxzqv       1/1     Running   <span style="color:#666">0</span>          45h
</code></pre></div><h2 id="22-catalog-operator">2.2 Catalog Operator</h2>
<p>The Catalog Operator is responsible for resolving and installing CSVs and the required resources they specify. It is also responsible for watching CatalogSources for updates to packages in channels and upgrading them (optionally automatically) to the latest available versions.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ oc get pod -n openshift-operator-lifecycle-manager | grep olm-operator
NAME                                READY   STATUS    RESTARTS   AGE
catalog-operator-74694fb4d4-g4fsk   1/1     Running   <span style="color:#666">0</span>          45h
</code></pre></div><p>A user who wishes to track a package in a channel creates a Subscription resource configuring the desired package, channel, and the CatalogSource from which to pull updates. When updates are found, an appropriate InstallPlan is written into the namespace on behalf of the user.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ oc get installplan -n openshift-operators | grep elasticsearch
install-b4628   elasticsearch-operator.4.3.20-202005121847   Automatic   <span style="color:#a2f">true</span>
install-fngg7   elasticsearch-operator.4.3.14-202004200457   Automatic   <span style="color:#a2f">true</span>
install-glfb4   elasticsearch-operator.4.3.22-202005201238   Automatic   <span style="color:#a2f">true</span>
install-hdrdv   elasticsearch-operator.4.3.19-202005041055   Automatic   <span style="color:#a2f">true</span>
install-k8jbq   elasticsearch-operator.4.2.29-202004140532   Automatic   <span style="color:#a2f">true</span>
install-l927k   elasticsearch-operator.4.4.0-202004261927    Automatic   <span style="color:#a2f">true</span>
install-px7tr   elasticsearch-operator.4.3.23-202005270305   Automatic   <span style="color:#a2f">true</span>
</code></pre></div><h2 id="23-resources-created-by-olm-and-catalog-operators">2.3 Resources created by OLM and Catalog Operators</h2>
<p>The resources created by the OLM and Catalog Operators are the following:</p>
<ul>
<li>OLM: Deployments, ServiceAccounts, (Cluster)Roles and (Cluster)RoleBindings</li>
<li>Catalog: Custom Resource Definitions (CRDs), ClusterServiceVersions (CSVs)</li>
</ul>
<h1 id="3-operator-lifecycle-manager-ecosystem">3. Operator Lifecycle Manager ecosystem</h1>
<p>So, now that we already explained the components of the OLM, we need to describe the ecosystem in order to deploy, upgrade and maintain our operators within the OLM.</p>
<p>In the Operator Lifecycle Manager (OLM) ecosystem, the following resources are used to resolve Operator installations and upgrades:</p>
<ul>
<li>ClusterServiceVersion (CSV)</li>
<li>CatalogSource</li>
<li>Subscription</li>
<li>Cluster Service Version (CSV)</li>
</ul>
<p><strong>A ClusterServiceVersion (CSV) is a YAML manifest created from Operator metadata that assists the Operator Lifecycle Manager (OLM) in running the Operator in a cluster.</strong></p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ oc get csv
NAME                                         DISPLAY                          VERSION
REPLACES                                     PHASE
elasticsearch-operator.4.3.23-202005270305   Elasticsearch Operator           4.3.23-202005270305
elasticsearch-operator.4.3.22-202005201238   Succeeded
jaeger-operator.v1.17.2                      Red Hat OpenShift Jaeger         1.17.2
kiali-operator.v1.12.12                      Kiali Operator                   1.12.12
kiali-operator.v1.12.11                      Succeeded
openshift-pipelines-operator.v0.10.7         OpenShift Pipelines Operator     0.10.7
openshift-pipelines-operator.v0.8.2          Succeeded
packageserver                                Package Server                   0.14.2
servicemeshoperator.v1.1.2.3                 Red Hat OpenShift Service Mesh   1.1.2+3
servicemeshoperator.v1.1.2.2                 Succeeded
</code></pre></div><p><strong>Catalog Sources</strong><br>
Operator metadata, defined in CSVs, can be stored in a collection called a CatalogSource. OLM uses CatalogSources, which use the Operator Registry API, to query for available Operators as well as upgrades for installed Operators.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ oc get CatalogSources -n openshift-marketplace
NAME                  DISPLAY               TYPE   PUBLISHER   AGE
certified-operators   Certified Operators   grpc   Red Hat     76d
community-operators   Community Operators   grpc   Red Hat     76d
redhat-marketplace    Red Hat Marketplace   grpc   Red Hat     18d
redhat-operators      Red Hat Operators     grpc   Red Hat     76d
</code></pre></div><p>Within a CatalogSource, Operators are organized into packages and streams of updates called channels, which should be a familiar update pattern from OpenShift Container Platform or other software on a continuous release cycle like web browsers.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ oc get CatalogSources -n openshift-marketplace community-operators -o yaml --export
Flag --export has been deprecated, This flag is deprecated and will be removed in future.
apiVersion: operators.coreos.com/v1alpha1
kind: CatalogSource
metadata:
  generation: <span style="color:#666">1</span>
  labels:
    olm-visibility: hidden
    openshift-marketplace: <span style="color:#b44">&#34;true&#34;</span>
    opsrc-datastore: <span style="color:#b44">&#34;true&#34;</span>
    opsrc-owner-name: community-operators
    opsrc-owner-namespace: openshift-marketplace
    opsrc-provider: community
  name: community-operators
  selfLink: /apis/operators.coreos.com/v1alpha1/namespaces/openshift-marketplace/catalogsources/community-operators
spec:
  address: community-operators.openshift-marketplace.svc:50051
  displayName: Community Operators
  icon:
    base64data: <span style="color:#b44">&#34;&#34;</span>
    mediatype: <span style="color:#b44">&#34;&#34;</span>
  publisher: Red Hat
  sourceType: grpc
</code></pre></div><p><strong>Subscriptions</strong><br>
A user indicates a particular package and channel in a particular CatalogSource in a Subscription.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ oc get subscription -n openshift-operators
NAME                           PACKAGE                        SOURCE                CHANNEL
elasticsearch-operator         elasticsearch-operator         redhat-operators      4.3
jaeger-product                 jaeger-product                 redhat-operators      stable
kiali-ossm                     kiali-ossm                     redhat-operators      stable
openshift-pipelines-operator   openshift-pipelines-operator   community-operators   dev-preview
servicemeshoperator            servicemeshoperator            redhat-operators      stable
</code></pre></div><p>If a Subscription is made to a package that has not yet been installed in the namespace, the latest Operator for that package is installed.</p>
<p>For example the Kiali subscription:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ oc get subscription -n openshift-operators kiali-ossm -o yaml --export
Flag --export has been deprecated, This flag is deprecated and will be removed in future.
apiVersion: operators.coreos.com/v1alpha1
kind: Subscription
metadata:
  generation: <span style="color:#666">1</span>
  name: kiali-ossm
  selfLink: /apis/operators.coreos.com/v1alpha1/namespaces/openshift-operators/subscriptions/kiali-ossm
spec:
  channel: stable
  installPlanApproval: Automatic
  name: kiali-ossm
  source: redhat-operators
  sourceNamespace: openshift-marketplace
  startingCSV: kiali-operator.v1.12.11
</code></pre></div></div>
		
<div class="post__tags tags clearfix">
	<svg class="icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5 0 11V3C0 1.5.8.8.8.8S1.5 0 3 0h8c1.5 0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/></svg>
	<ul class="tags__list">
		<li class="tags__item"><a class="tags__link btn" href="/tags/ocp/" rel="tag">OCP</a></li>
		<li class="tags__item"><a class="tags__link btn" href="/tags/operator/" rel="tag">OPERATOR</a></li>
	</ul>
</div>

	</article>
  
  
</main>

































































































































<div class="authorbox clearfix">
	<figure class="authorbox__avatar">
		<img alt="Tomáš Dědič avatar" src="/img/avatar.png" class="avatar" height="30" width="30">
	</figure>
	<div class="authorbox__header">
		
		<span class="authorbox__name">Tomáš Dědič</span>
	</div>
	
	
	
	
	
</div>


<nav class="post-nav flex">
	<div class="post-nav__item post-nav__item--prev">
		<a class="post-nav__link" href="/openshift/debug/debug-oauth/" rel="prev"><span class="post-nav__caption">«&thinsp;Previous</span><p class="post-nav__post-title">Authentication operator degraded </p></a>
	</div>
	<div class="post-nav__item post-nav__item--next">
		<a class="post-nav__link" href="/openshift/snippets/" rel="next"><span class="post-nav__caption">Next&thinsp;»</span><p class="post-nav__post-title">Snippets</p></a>
	</div>
</nav>

			</div>
			

		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2021 DIVIDED DOCUMENTATION.
			
		</div>
	</div>
</footer>

	</div>
<script async defer src="/js/menu.js"></script></body>
</html>
